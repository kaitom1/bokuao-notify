name: bokuao-blog-notify

on:
  schedule:
    - cron: "00 09 * * *" # JST 18:00
    - cron: "00 12 * * *" # JST 21:00
    - cron: "00 13 * * *" # JST 22:00
    - cron: "00 14 * * *" # JST 23:00
  workflow_dispatch:

jobs:
  run:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install deps
        run: pip install requests beautifulsoup4

      # 1) まず復元（最新の state を拾う）
      - name: Restore state
        uses: actions/cache/restore@v4
        with:
          path: state.json
          key: bokuao-state-${{ runner.os }}-${{ github.run_id }}
          restore-keys: |
            bokuao-state-${{ runner.os }}-

      - name: Run notifier
        env:
          AMI_KANAZAWA: ${{ secrets.AMI_KANAZAWA }}
          SUZUKI_HAYASAKI: ${{ secrets.SUZUKI_HAYASAKI }}
          AOI_ANNO: ${{ secrets.AOI_ANNO }}
          NANA_SHIOGAMA: ${{ secrets.NANA_SHIOGAMA }}
          KOKOKA_HAGIWARA: ${{ secrets.KOKOKA_HAGIWARA }}
          YUA_KUDO: ${{ secrets.YUA_KUDO }}
          EREN_SUGIURA: ${{ secrets.EREN_SUGIURA }}
          TOA_YAGI: ${{ secrets.TOA_YAGI }}
          MIUNA_SUNAGA: ${{ secrets.MIUNA_SUNAGA }}
          KAREN_YANAGIHORI: ${{ secrets.KAREN_YANAGIHORI }}
          HITOMI_HASEGAWA: ${{ secrets.HITOMI_HASEGAWA }}
          YUHO_AOKI: ${{ secrets.YUHO_AOKI }}
          COCONA_YOSHIMOTO: ${{ secrets.COCONA_YOSHIMOTO }}
          YUZU_ITO: ${{ secrets.YUZU_ITO }}
          YUKI_IMAI: ${{ secrets.YUKI_IMAI }}
          RIAN_AKITA: ${{ secrets.RIAN_AKITA }}
          YURIA_MIYAKOSHI: ${{ secrets.YURIA_MIYAKOSHI }}
          RIKO_IWAMOTO: ${{ secrets.RIKO_IWAMOTO }}
          AYA_NISHIMORI: ${{ secrets.AYA_NISHIMORI }}
          MIISA_YAEGASHI: ${{ secrets.MIISA_YAEGASHI }}
        run: python notify_bokuao.py

      # 2) 実行後の state を必ず保存（毎回ユニークkeyで新規保存）
      - name: Save state
        if: always()
        uses: actions/cache/save@v4
        with:
          path: state.json
          key: bokuao-state-${{ runner.os }}-${{ github.run_id }}
