name: bokuao-blog-notify

on:
  schedule:
    # JST 23:59 = UTC 14:59
    - cron: "59 14 * * *"
  workflow_dispatch:

jobs:
  blog:
    runs-on: ubuntu-latest

    steps:
      # リポジトリをチェックアウト
      - name: Checkout repository
        uses: actions/checkout@v4

      # Python セットアップ
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      # 依存関係インストール
      - name: Install dependencies
        run: |
          pip install requests beautifulsoup4

      # state.json をキャッシュから復元
      - name: Restore blog state
        uses: actions/cache@v4
        with:
          path: state.json
          key: bokuao-blog-state

      # BLOG 通知スクリプト実行
      - name: Run blog notifier
        env:
          AMI_KANAZAWA: ${{ secrets.AMI_KANAZAWA }}
          SUZUKI_HAYASAKI: ${{ secrets.SUZUKI_HAYASAKI }}
          AOI_ANNO: ${{ secrets.AOI_ANNO }}
        run: python notify_bokuao.py

      # state.json を保存
      - name: Save blog state
        uses: actions/cache@v4
        with:
          path: state.json
          key: bokuao-blog-state
